# 9단계: 리뷰 대응

## 목표

PR 리뷰 결과를 확인하고, 변경 요청이 있으면 수정하여 다시 push합니다.

## 수행 절차

### 1. 리뷰 상태 확인 (Polling)

PR 생성 후 리뷰 결과를 주기적으로 확인합니다.

```bash
# PR의 최신 리뷰 상태 확인
gh pr view [PR번호] --json reviews --jq '.reviews[-1].state'

# 또는 PR 코멘트 확인
gh pr view [PR번호] --json comments --jq '.comments[-1].body'
```

### 2. 리뷰 결과에 따른 분기

#### APPROVED (승인됨)
```
→ "PR이 승인되었습니다!" 출력
→ 작업 완료, merge는 사람이 진행
```

#### CHANGES_REQUESTED (변경 요청)
```
→ 리뷰 피드백 확인
→ 3단계로 이동 (수정 작업)
```

#### 코멘트에 "Changes Requested" 포함
```
→ 코멘트 내용 파싱
→ 수정 사항 추출
→ 3단계로 이동
```

### 3. 피드백 확인

```bash
# 리뷰 코멘트 내용 확인
gh pr view [PR번호] --json reviews --jq '.reviews[-1].body'

# 또는 일반 코멘트 확인
gh pr view [PR번호] --json comments --jq '.comments[-1].body'
```

### 4. 수정 작업

피드백에서 요청한 사항을 수정합니다:

1. 코드 수정
2. 테스트 확인
3. 커밋
```bash
git add .
git commit -m "fix: 리뷰 피드백 반영

- [수정 내용 1]
- [수정 내용 2]

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>"
```

4. Push
```bash
git push origin [브랜치명]
```

### 5. 재리뷰 대기

수정 push 후 다시 1단계로 돌아가 리뷰 결과를 확인합니다.

## 리뷰-수정 루프

```
┌─────────────────────────────────────────────────┐
│                                                 │
│   PR 생성 → 리뷰 대기 → 리뷰 확인              │
│                           │                     │
│                    ┌──────┴──────┐              │
│                    │             │              │
│                 승인됨      변경요청             │
│                    │             │              │
│                    ▼             ▼              │
│                  완료!       코드 수정          │
│                                  │              │
│                                  ▼              │
│                              재 push            │
│                                  │              │
│                                  └──→ 리뷰 대기 │
│                                                 │
└─────────────────────────────────────────────────┘
```

## Polling 간격

- 첫 번째 확인: PR 생성 후 60초 대기
- 이후: 30초마다 확인
- 최대 반복: 10회 (5분)

## 리뷰 피드백 파싱

리뷰 코멘트에서 수정 사항을 추출합니다:

```
## Review: Changes Requested

### 수정 필요
1. docstring을 추가해주세요     ← 이 부분 추출
2. 타입 힌트를 추가해주세요     ← 이 부분 추출
```

## 체크리스트

- [ ] 리뷰 상태를 확인했는가?
- [ ] 변경 요청 내용을 정확히 파악했는가?
- [ ] 모든 피드백을 반영했는가?
- [ ] 수정 후 테스트를 확인했는가?
- [ ] 재 push 했는가?

## 주의사항

- **피드백 정확히 반영** - 요청한 것만 수정, 추가 변경 금지
- **커밋 메시지** - 무엇을 수정했는지 명확히 기술
- **무한 루프 방지** - 최대 반복 횟수 제한 (10회)
